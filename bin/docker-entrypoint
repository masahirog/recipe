
# If running the rails server then create or migrate existing database
if [ "${1}" == "./bin/rails" ] && [ "${2}" == "server" ]; then
  ./bin/rails db:prepare
  
  # 初回のみseedを実行（データが空の場合のみ）
  if [ "$RAILS_ENV" = "production" ]; then
    echo "Checking if seed data is needed..."
    # Productテーブルにデータがあるかチェック
    if ! ./bin/rails runner "exit Product.any? ? 0 : 1" 2>/dev/null; then
      echo "Running seed data..."
      ./bin/rails db:seed || echo "Seed failed but continuing..."
    else
      echo "Seed data already exists, skipping..."
    fi
  fi
fi

exec "${@}"